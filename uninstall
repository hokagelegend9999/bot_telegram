#!/bin/bash

# =================================================================================
# Uninstaller Otomatis untuk Jualan Bot Telegram (Final)
# Developer By : Hokage Legend.
# =================================================================================

# --- Warna untuk Output ---
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
CYAN='\033[0;36m'
NC='\033[0m'

# --- Fungsi ---
info() { echo -e "${CYAN}[INFO]${NC} $1"; }
success() { echo -e "${GREEN}[SUCCESS]${NC} $1"; }
warning() { echo -e "${RED}[WARNING]${NC} $1"; }

# --- Cek Root ---
if [ "$(id -u)" -ne 0 ]; then
   echo "Skrip ini harus dijalankan sebagai root."
   exit 1
fi

# --- Konfirmasi Pengguna ---
clear
echo -e "${YELLOW}=====================================================${NC}"
warning "         PENGHAPUSAN JUALAN BOT TELEGRAM"
echo -e "${YELLOW}=====================================================${NC}"
echo ""
warning "Skrip ini akan MENGHAPUS secara permanen komponen bot."
info "Paket Nginx TIDAK akan dihapus."
echo ""
read -p "Anda yakin ingin melanjutkan? (ketik 'y' untuk lanjut): " CONFIRMATION
if [ "$CONFIRMATION" != "y" ]; then
    info "Penghapusan dibatalkan."
    exit 0
fi

# --- Mulai Proses Penghapusan ---

info "1. Menghentikan dan menghapus layanan systemd..."
systemctl stop jualan_bot.service > /dev/null 2>&1
systemctl disable jualan_bot.service > /dev/null 2>&1
rm -f /etc/systemd/system/jualan_bot.service
systemctl daemon-reload
success "Layanan bot berhasil dihentikan dan dihapus."

info "2. Menghapus file-file bot..."
FILES_TO_REMOVE=(
    "/usr/bin/jualan.py" "/usr/bin/jualan.db"
    "/usr/bin/addss-bot" "/usr/bin/addssh-bot" "/usr/bin/addvless-bot" "/usr/bin/addws-bot"
    "/usr/bin/bot-backup" "/usr/bin/bot-cek-login-ssh" "/usr/bin/bot-trial" "/usr/bin/bot-trialtrojan"
    "/usr/bin/bot-trialvless" "/usr/bin/bot-trialws" "/usr/bin/bot-trialss" "/usr/bin/bot-vps-info"
    "/usr/bin/resservice" "/usr/bin/bot-cek-vless" "/usr/bin/bot-cek-vmess"
)
for file in "${FILES_TO_REMOVE[@]}"; do
    if [ -f "$file" ]; then rm -f "$file"; fi
done

if [ -d "/usr/bin/jualanbot_env" ]; then
    rm -rf "/usr/bin/jualanbot_env"
fi
success "Semua file bot dan lingkungan virtual berhasil dihapus."

info "3. Opsi untuk menghapus paket 'at'..."
read -p "Apakah Anda ingin menghapus layanan 'at' (penjadwal tugas)? (y/n): " REMOVE_AT
if [ "$REMOVE_AT" == "y" ]; then
    apt-get purge --auto-remove at -y > /dev/null 2>&1
    success "'at' berhasil dihapus."
else
    info "'at' tidak dihapus."
fi

echo ""
success "Proses penghapusan Jualan Bot telah selesai."
info "ok..cuyy...sudah terhapus."
